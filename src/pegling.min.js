"use strict";var Pegling=function(){function prime(a,b=[]){function c(b,g,h){d("at",b.substr(g).split("\n")[0],h);let i=b.length;if(g>i)return[-1,"eof"];switch(h[0]){case"var":{d("*nt",b.substr(g).split("\n")[0],h),e.push(h[1]);let f=c(b,g,a[h[1]]);return e.pop(),d("nt*",f,h)}break;case"cat":{let a=[];for(let d=1;d<h.length;d++){let[e,f]=c(b,g,h[d]);if(e>=g)g=e,a.push(f);else return[-1,[h[0],d,g,a,f]]}return d(".cat",[g,["#cat",a]])}break;case"/":{for(let a=1;a<h.length;a++){let e=c(b,g,h[a]),[f,i]=e;if(f>=g){return d("./",[f,i])}}return[-1,[h[0],["#/",g]]]}break;case"+":{let a=[],[e,f]=c(b,g,h[1]);if(e>=g){do{g=e,a.push(f);let d=c(b,g,h[1]);[e,f]=d}while(e>g);return d("+",[g,a])}return[-1,[h[0],g,["#+",f]]]}break;case"*":{let a=[],[e,f]=c(b,g,h[1]);for(;e>=g;){g=e,a.push(f);let d=c(b,g,h[1]);[e,f]=d}return d("*",[g,["#*",a]])}break;case"?":{let[a,e]=c(b,g,h[1]);return d("?",a>g?[a,e]:[g,["#?"]])}break;case"^":{let[a,e]=c(b,g,h[1]);return d("^",a>g?[a,e]:[-1,[h[0],g,b.substring(g,a),e,h[1]]])}break;case"&":{let[a,e]=c(b,g,h[1]);return d("&",a>g?[g,["#&"]]:[-1,[h[0],g,b.substring(g,a),e,h[1]]])}break;case"#":{let a=c(b,g,h[1]),[e,f]=a;if(0>e)return a;return d("log",h[1],h[2],b.substring(g,e),f),a}break;case"!":{let[a,e]=c(b,g,h[1]);return d("!",a>g?[-1,[h[0],g,b.substring(g,a),e,h[1]]]:[g,["#!"]])}break;case"cc":{let a=new RegExp("["+h[1].replace("]","\\]")+"]"),c=b[g];return d("cc",a.test(c)&&g<=i?[g+1,["#cc",c]]:[-1,[h[0],g,c,h[1]]])}break;case".":return d(".",g<=i?[g+1,["#.",b[g]]]:[-1,[h[0],g,b[g]]]);break;case"span":{let a=h[1].length,c=b.substr(g,a);return d("span",c===h[1]&&g+a<=i?[g+a,["#span",c]]:[-1,[h[0],g,c,h[1]]])}break;default:{let a=h[0];switch(typeof a){case"function":let f=c(b,g,h[1]),[i,j]=f;return 0>i?f:d("fun",[i,a(j)],a,e);case"string":console.error("unknown code \""+a+"\"");}}}}function d(b,c,...d){switch(b){case"at":return f.attempt&&console.log(c,...d),null;case"*nt":if(f.nonterminals){let a=d[0][1];console.log((e.length+"").padStart(3,"0")+"%"+"  ".repeat(e.length),b,a,c,e)}return null;case"nt*":if(f.nonterminals){let a=d[0][1];console.log((e.length+"").padStart(3,"0")+"%"+"  ".repeat(e.length),b,a,c,e)}break;case"cat":case"/":case"+":case"*":case"?":case"&":case"!":case"cc":case".":case"span":f.engine&&console.log(b," -> ",c);break;case"log":if(f.mylogs){let[a,e,f]=d;console.log(b+" "+c+" str: %c"+e,"background: #ddd;"),console.log("ast:",f)}break;case"fun":if(f.myfuns){let[a,e]=d;console.log(b,a," ~~> ",c[1],"in",e)}}return c}let e,f=b.reduce((b,a)=>(b[a]=!0,b),{});return function(b,d){e=[];let f=c(b,0,a[d])[1];return f}}const pegRules={grammar:[a=>a.reduce((b,a)=>(b[a[1]]=a[2],b),{}),["+",[a=>["cat",a[1][0][1],a[1][3]],["#",["cat",["var","nonterminal"],["span","<-"],["var","sp"],["var","pattern"]]]]]],pattern:[a=>0==a[1][1][1].length?a[1][0]:a[1][1][1].reduce((b,a)=>(b.push(a[1][2]),b),["/",a[1][0]]),["cat",["var","alternative"],["*",["cat",["span","/"],["var","sp"],["var","alternative"]]]]],alternative:[a=>2<=a.length?["cat"].concat(a):a[0],["+",[a=>1<a[1][0].length?[a[1][0][1],a[1][2]]:a[1][2],["cat",["?",["cc","!&#^"]],["var","sp"],["var","suffix"]]]]],suffix:[a=>a[1][1][1].reduce((b,a)=>[a[1][0][1],b],a[1][0]),["cat",["var","primary"],["*",["cat",["cc","*+?"],["var","sp"]]]]],primary:["/",[a=>a[1][2],["cat",["span","("],["var","sp"],["var","pattern"],["var","sp"],["span",")"],["var","sp"]]],[()=>["."],["cat",["span","."],["var","sp"]]],["var","literal"],["var","charclass"],[a=>[a[1][0],a[1][3]],["cat",["var","code"],["span","("],["var","sp"],["var","pattern"],["span",")"],["var","sp"]]],[a=>["var",a[1][0][1]],["cat",["var","nonterminal"],["!",["span","<-"]]]]],literal:[a=>["span",a[1][1][1].reduce((b,a)=>b+a[1][1][1],"")],["cat",["span","'"],["*",["cat",["!",["span","'"]],["."]]],["span","'"],["var","sp"]]],charclass:[a=>["cc",a[1][2][1].reduce((b,a)=>a[1][1][1]instanceof Array?b+a[1][1][1][0][1]+"-"+a[1][1][1][2][1]:b+a[1][1][1],1<a[1][1].length?"]":"")],["cat",["span","["],["?",["span","]"]],["*",["cat",["!",["span","]"]],["/",["cat",["."],["span","-"],["."]],["."]]]],["span","]"],["var","sp"]]],nonterminal:[a=>["@nt",a[1][0].reduce((b,a)=>b+a[1],"")],["cat",["+",["cc","a-zA-Z"]],["var","sp"]]],code:[ast=>eval(ast[1][1][1].reduce((b,a)=>b+a[1][1][1],"")),["cat",["span","{{"],["*",["cat",["!",["span","}}"]],["."]]],["span","}}"],["var","sp"]]],sp:[()=>[],["*",["cc"," \t\n"]]]};let pegc=prime(pegRules),mkPhase1=function(a){let b=a&&0<a.length?prime(pegRules,a):pegc;return a=>b(a,"grammar")},mkXpiler=function(a,b,c){let d=mkPhase1(b);return prime(d(a),c)};return{pegRules:pegRules,prime:prime,mkPhase1:mkPhase1,mkXpiler:mkXpiler}}();